ARG NODE_IMAGE_TAG=14-buster-slim
ARG DOCKER_REGISTRY_PREFIX=frappe
ARG IMAGE_TAG=develop

FROM node:${NODE_IMAGE_TAG}

ARG GIT_REPO=git@git.arterypartner.com:artery/ap-application/shopee_open_api.git
ARG GIT_BRANCH=version-13
ARG FRAPPE_BRANCH=${GIT_BRANCH}

COPY build/shopee_open_api-nginx/install_app.sh /install_app
RUN chmod +x /install_app && \
  apt-get update -y && \
  apt-get install build-essential git python2 -y && \
  apt-get clean && \
  rm -rf /var/lib/apt/lists/*
RUN /install_app shopee_open_api git@git.arterypartner.com:artery/ap-application/shopee_open_api.git version-13 version-13

FROM frappe/erpnext-nginx:edge

COPY --from=0 /home/frappe/frappe-bench/sites/ /var/www/html/
COPY --from=0 /rsync /rsync
RUN echo -n "shopee_open_api" >> /var/www/html/apps.txt

VOLUME [ "/assets" ]

ENTRYPOINT ["/docker-entrypoint.sh"]
CMD ["nginx", "-g", "daemon off;"]